<select id="deliveryDateBox" class="jp">
  <option value="0">指定なし</option>
  {% assign plusSeconds = 0 | times: 24 | times: 60 | times: 60 %}
  {% assign weekDayToday = "today" | date: '%s' | plus: plusSeconds | date: "%w" %}
  {% assign dayTime = "today" | date: '%s' | plus: plusSeconds | date: "%H" %}
  {% assign dayTime = dayTime | plus: 0 %}
  {% assign displayIndex = 0 | plus: 0 %}
  {% assign dateWeekToday = "today" | date: '%s' | plus: plusSeconds | date: "%w" | plus: 0  %}
  {% assign holidayArray = "2024-01-01,2024-01-02,2024-01-03,2024-01-04,2024-01-08,2024-02-11,2024-02-12,2024-02-23,2024-03-20,2024-04-29,2024-05-03,2024-05-04,2024-05-05,2024-05-06,2024-07-15,2024-08-12,2024-09-16,2024-09-23,2024-10-14,2024-11-03,2024-11-04,2024-11-23" %}
  {% if dayTime < 10 %}
    <script>console.log('10時以前')</script>
    {% comment %} 10時までの注文 {% endcomment %}
    {% if dateWeekToday == 0 %}
      <script>console.log('日曜日')</script>
      {% assign deriveryBufferDate = 1 | plus: 0 %}
      {% assign bufferDate = 2 | plus: 0 %}
      {% assign reloadTime = 10 | plus: 0 %}
    {%- elsif dateWeekToday == 6  -%}
      <script>console.log('土曜日')</script>
      {% assign deriveryBufferDate = 2 | plus: 0 %}
      {% assign bufferDate = 3 | plus: 0 %}
      {% assign reloadTime = 10 | plus: 0 %}
    {%- else -%}
      {% assign deriveryBufferDate = 0 | plus: 0 %}
      {% assign bufferDate = 1 | plus: 0 %}
      {% if dateWeekDay == 5 %}
        <script>console.log('金曜日')</script>
        {% assign reloadTime = 14 | plus: 0 %}
      {%- else -%}
        <script>console.log('月~木曜日')</script>
        {% assign reloadTime = 10 | plus: 0 %}
      {%- endif -%}
    {%- endif -%}
  {%- else -%}
    <script>console.log('10時以降')</script>
    {% comment %} 10時以降の注文 {% endcomment %}
    {% if dateWeekToday == 6 %}
      <script>console.log('土曜日')</script>
      {% assign deriveryBufferDate = 2 | plus: 0 %}
      {% assign bufferDate = 3 | plus: 0 %}
    {%- elsif dateWeekToday == 5 -%}
      <script>console.log('金曜日')</script>
      {% comment %} 金曜日の14時以降以前の分岐 {% endcomment %}
      {% if dayTime < 14 %}
        {% assign deriveryBufferDate = 0 | plus: 0 %}
        {% assign bufferDate = 1 | plus: 0 %}
        {% assign reloadTime = 14 | plus: 0 %}
      {%- else -%}
        {% assign deriveryBufferDate = 3 | plus: 0 %}
        {% assign bufferDate = 4 | plus: 0 %}
        {% assign reloadTime = 14 | plus: 0 %}
      {%- endif -%}
    {%- else -%}
      <script>console.log('日or月~木')</script>
      {% assign deriveryBufferDate = 1 | plus: 0 %}
      {% assign bufferDate = 2 | plus: 0 %}
      {% assign reloadTime = 10 | plus: 0 %}
    {%- endif -%}
  {%- endif -%}



  {% for i in (bufferDate..30) %}

  {% assign deriveryDate = deriveryBufferDate | times: 24 | times: 60 | times: 60 %}
  {% assign deriveryDateDisplay = 'today' | date: '%s' | plus: deriveryDate | date: '%Y-%m-%d' %}
  {% assign deriveryDateWeekDay = 'today' | date: '%s' | plus: deriveryDate | date: '%w' | plus: 0 %}
  {% assign seconds = i | times: 24 | times: 60 | times: 60 %}
  {% assign dateValue = 'today' | date: '%s' | plus: seconds | date: '%Y-%m-%d' %}
  {% assign dateDisplayM = 'today' | date: '%s' | plus: seconds | date: '%m' %}
  {% assign dateDisplayM = dateDisplayM | plus: 0 %}
  {% assign dateDisplayD = 'today' | date: '%s' | plus: seconds | date: '%d' %}
  {% assign dateDisplayD = dateDisplayD | plus: 0 %}
  {% assign dateWeekDay = 'today' | date: '%s' | plus: seconds | date: '%w' %}
  {% if dateWeekDay == '0' %}{% assign weekDay = '(日)' %}{%- endif -%}
  {% if dateWeekDay == '1' %}{% assign weekDay = '(月)' %}{%- endif -%}
  {% if dateWeekDay == '2' %}{% assign weekDay = '(火)' %}{%- endif -%}
  {% if dateWeekDay == '3' %}{% assign weekDay = '(水)' %}{%- endif -%}
  {% if dateWeekDay == '4' %}{% assign weekDay = '(木)' %}{%- endif -%}
  {% if dateWeekDay == '5' %}{% assign weekDay = '(金)' %}{%- endif -%}
  {% if dateWeekDay == '6' %}{% assign weekDay = '(土)' %}{%- endif -%}
  {% if displayIndex == 0 %}
  {% unless holidayArray contains deriveryDateDisplay %}
  {% if deriveryDateWeekDay != 6 and deriveryDateWeekDay != 0 %}
  <option value="{{dateValue}}">{{dateDisplayM}}月{{dateDisplayD}}日{{weekDay}} ※一部地域のみ</option>
  {% assign displayIndex = displayIndex | plus: 1 %}
  {% assign firstDay = dateValue %}
  {% capture firstDayDisplay %}{{dateDisplayM}}月{{dateDisplayD}}日{{weekDay}}{% endcapture %}
  {%- else -%}
  {% assign deriveryBufferDate = deriveryBufferDate | plus: 1 %}
  {%- endif -%}
  {%- else -%}
  {% assign deriveryBufferDate = deriveryBufferDate | plus: 1 %}
  {% endunless %}
  {%- else -%}
  {% if displayIndex == 1 %}
  {% capture secondDay %}{{dateDisplayM}}月{{dateDisplayD}}日{{weekDay}}{% endcapture %}
  {% capture secondDayValue %}{{dateValue}}{% endcapture %}
  {% assign displayIndex = displayIndex | plus: 1 %}
  {% elsif displayIndex == 7 %}
  {% capture okinawaDay %}{{dateDisplayM}}月{{dateDisplayD}}日{{weekDay}}{% endcapture %}
  {% assign displayIndex = displayIndex | plus: 1 %}
  {%- endif -%}
  <option class="option{{displayIndex}}" value="{{dateValue}}">{{dateDisplayM}}月{{dateDisplayD}}日{{weekDay}}</option>
  {% assign displayIndex = displayIndex | plus: 1 %}
  {%- endif -%}
  {%- endfor -%}
</select>
<input id="dateInput" type="hidden" name="attributes[配送予定日:]" value="{{ secondDayValue }}">
<!-- <p class="example">※お届け先が【四国/九州/中国地方、北海道/青森県/秋田県/和歌山県】の場合、最短指定日は{{secondDay}}になります。沖縄県の場合、最短指定日は{{okinawaDay}}になります。</p> -->
<script>
var deliveryDate = $('#deliveryDateBox');

deliveryDate.on({
  'change': function() {
    if(deliveryDate.val() == '{{firstDay}}' ){
    var result = window.confirm('お届け先が【四国/九州/中国地方、北海道/青森県/秋田県/和歌山県/沖縄県】の場合、最短指定日は' + '{{secondDay}}' + 'になります。\n' + '{{firstDayDisplay}}' + 'を配送指定日にしますか？');
      if( result ) {

      }else {
        deliveryDate.val('指定なし');
      }
    }
    var inputValue = deliveryDate.val();
    var secondDay = $('#deliveryDate').find('.option2').val();
    if(inputValue != 0){
      $('#dateInput').val(inputValue);
    }else{
      $('#dateInput').val(secondDayValue);
    }
  }
});

function getDayUpdate(){
  var today = new Date();
  var dayTime = today.getHours();
  var dayMinutes = today.getMinutes();
  var daySeconds = today.getSeconds();
  if(dayTime == '{{reloadTime}}' && dayMinutes == 0 && daySeconds == 0){
    location.reload();
  }
  if(daySeconds == 0){
    console.log(dayTime + '時' + dayMinutes + '分' + daySeconds + '秒');
  }
  setTimeout(function() {
    getDayUpdate();
  }, 1000);
}

getDayUpdate();




</script>
