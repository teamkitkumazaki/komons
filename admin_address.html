<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5LVFKHJ');</script>
<!-- End Google Tag Manager -->

<style>
.socialplus-line-connection{
  display: none;
}
.icon-svg{display: none;}
.map{display: none;}
.display-table .content-box__row{border-top: 0px;}
.sns_wrap ul{
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}
.sns_wrap ul li{
  width: 49%;
  margin-bottom: 10px;
}
.sns_wrap ul li:nth-last-of-type(1){
  margin-right: 0px;
}
.sns_wrap ul li a{
  transition: opacity .3s;
  display: block;
  width: 100%;
  padding: 10px;
  box-sizing: border-box;
  border-radius: 5px;
  color: #fff;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  transition: hover .2s;
}
.sns_wrap ul li a:hover{
  opacity: 0.85;
}
.sns_wrap ul li a .icon{
  display: block;
  height: 18px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center center;
  filter: brightness(100);
}
.sns_wrap ul li a .text{
  display: block;
  font-size: 14px;
  line-height: normal;
  letter-spacing: 0.5px;
  margin-left: 10px;
}
.sns_wrap ul li a.tw{
  background-color: #1da1f2;
}
.sns_wrap ul li a.tw .icon{
  width: 17px;
}
.sns_wrap ul li a.fb{
  background-color: #195eb8;
}
.sns_wrap ul li a.fb .icon{
  width: 14px;
}
.sns_wrap ul li a.ig{
   background-image: linear-gradient(100deg, rgba(193, 53, 132, 0.99), #f77737 100%);
}
.sns_wrap ul li a.ig .icon{
  width: 15px;
}
.sns_wrap ul li a.line{
  background-color: #00c300;
}
.sns_wrap ul li a.line .icon{
  width: 18px;
}
.line_wrapper{
  margin-top: 30px;
}
.line_wrapper .line_ttl{
  font-size: 22px;
  color: #084A2C !important;
  margin-bottom: 15px;
}
.line_wrapper .img_wrap{
  margin-bottom: 15px;
}
.line_wrapper .img_wrap a{
  display: block;
}
.line_wrapper .line_sub_ttl{
  font-size: 18px;
  color: #084A2C !important;
  margin-bottom: 10px;
}
.line_wrapper .line_button{
  margin-top: 15px;
}
.line_wrapper .line_button a{
  display: block;
  background: #00C300;
  color: #fff;
  border-radius: 200px;
  padding: 15px 0 10px;
  text-align: center;
}
.line_wrapper .line_button a img{
  width: auto;
  margin: 0 auto;
  height: 26px;
}

.instagram{
  margin: 50px 0 20px;
}
.instagram .title_wrap{
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 0 5px;
  margin-bottom: 30px;
}
.instagram .title_wrap .ttl_box{
  max-width: 145px;
}
.instagram .title_wrap .link_wrap{
  max-width: 165px;
}
.instagram .title_wrap .link_wrap a{
  display: block;
  transition: opacity .2s;
}
.instagram .title_wrap .link_wrap a:hover{
  opacity: 0.8;
}
.instagram .insta_wrap{
  display: flex;
  flex-wrap: wrap;
  border-top: 1px solid #d8d8d8;
  border-right: 1px solid #d8d8d8;
}

.instagram .insta_wrap a{
  display: block;
  width: 25%;
  box-sizing: border-box;
  border-left: 1px solid #d8d8d8;
  border-bottom: 1px solid #d8d8d8;
  transition: opacity .2s;
  line-height: 0;
}
.instagram .insta_wrap a:hover{
  opacity: 0.8;
}

@media screen and (max-width: 720px){
  .sns_wrap ul li{
    width: 100%;
    margin-bottom: 7px;
  }
  .instagram{
    margin: 50px 0 20px;
  }
  .instagram .title_wrap{
    margin-bottom: 20px;
  }
  .instagram .title_wrap .ttl_box{
    max-width: 120px;
  }
  .instagram .title_wrap .link_wrap{
    max-width: 120px;
  }
}
</style>
<script type="text/javascript" src="https://cdn.shopify.com/s/files/1/0536/9544/7234/t/2/assets/jquery-3.3.1.min.js" charset="UTF-8"></script>
<script>
$(function() {
    function checkoutSet(){
      var i = 0;
      var attributeBox = [];
      var checkoutNote;
      var cartAttribute;
      var note = `{{ checkout.note }}`;
      var paymentMethod = $('.payment-method-list__item__info').text();
      var attributeLength = 0;
      var totelPrice = '{{ checkout.total_price | money_without_currency }}';
      var taxPrice = '{{ checkout.tax_price | money_without_currency }}'
      $('#main-header').html('ご注文頂きありがとうございます。');

      function addCODPrice(){
        var plusCOD = Number(totelPrice.replace(/,/g, '')) + Number(330);
        var plusCODTax = Number(taxPrice.replace(/,/g, '')) + Number(30);
        $('.total-line-table__tbody').append('<tr class="total-line total-line--shipping"><th class="total-line__name" scope="row"><span>代引手数料</span></th><td class="total-line__price"><span class="skeleton-while-loading order-summary__emphasis" data-checkout-total-shipping-target="66000">￥330</span></td></tr>');
        $('.payment-due__price').text('¥' + plusCOD.toLocaleString());
        $('.payment-due-label__taxes span').text('¥' + plusCODTax.toLocaleString());
      }

      function addCartNoteDisplay(){
        $('.step__sections').append('<div class="content-box"><div class="content-box__row content-box__row--no-border"><h2>備考</h2></div><!-- content-box --><div class="content-box__row"><div class="section__content"><p style="white-space: pre-line;">' + note + '</p></div><!-- section__content --></div><!-- content-box__row --></div><!-- content-box -->');
      }

      function addCartAttributeDisplay(e, num){
        var splitText = e.split(':')
        console.log('text:' + splitText + '/ num:' + num);
        if(num == 0){
          cartAttribute.append('<h3 class="heading-3">' + splitText[0] + '</h3><p style="white-space: pre-line; margin-bottom: 20px;">' + splitText[1] + '</p>');
        }else if(num == 1){
          cartAttribute2.append('<h3 class="heading-3">' + splitText[0] + '</h3><p style="white-space: pre-line; margin-bottom: 20px;">' + splitText[1] + '</p>');
        }else if(num == 2){
          giftAttribute.append('<h3 class="heading-3">' + splitText[0] + '</h3><p style="white-space: pre-line; margin-bottom: 20px;">' + splitText[1] + '</p>');
        }else if(num == 3){
          giftAttribute2.append('<h3 class="heading-3">' + splitText[0] + '</h3><p style="white-space: pre-line; margin-bottom: 20px;">' + splitText[1] + '</p>');
        }else{
          giftAttribute3.append('<h3 class="heading-3">' + splitText[0] + '</h3><p style="white-space: pre-line; margin-bottom: 20px;">' + splitText[1] + '</p>');
        }
      }

      function setContactLink(){
        var checkoutNote = note;
        var targetLink = $('.step__footer__info').find('a');
        targetLink.attr('href', 'https://komons-japan.com/pages/contact');
        targetLink.attr('target', '_blank');
      }

      function init(){
        {% for item in checkout.attributes %}
          attributeLength = attributeLength + 1;
        {% endfor %}
        console.log('attributeLength:' + attributeLength);
        setContactLink();
        $('.step__sections').append(`
          <div class="content-box">
            <div class="content-box__row content-box__row--no-border">
              <h2>配送情報/オプション情報</h2>
            </div>
            <div class="content-box__row">
              <div class="section__content">
                <div class="section__content__column" style="width: 100%">
                  <div id="cartAttribute01" class="text-container"></div>
                </div><!-- section__content__column -->
                <div class="section__content__column" style="width: 100%">
                  <div id="cartAttribute02" class="text-container"></div>
                </div>
                <!-- section__content__column -->
              </div><!-- section__content -->
              <div class="section__content__column" style="width: 100%">
                <div id="giftAttribute01" class="text-container"></div>
              </div>
              <!-- section__content__column -->
              <div class="section__content__column" style="width: 100%">
                <div id="giftAttribute02" class="text-container"></div>
              </div>
              <!-- section__content__column -->
              <div class="section__content__column" style="width: 100%">
                <div id="giftAttribute03" class="text-container"></div>
              </div>
              <!-- section__content__column -->
            </div><!-- section__content -->
            </div><!-- content-box__row -->
          </div><!-- content-box -->`);
        cartAttribute = $('#cartAttribute01');
        cartAttribute2 = $('#cartAttribute02');
        giftAttribute = $('#giftAttribute01');
        giftAttribute2 = $('#giftAttribute02');
        giftAttribute3 = $('#giftAttribute03');
        commentMemo = $('#commentMemo');
        var i = 0;
        {% for item in checkout.attributes %}
          attributeBox[i] = `{{ item }}`;
          addCartAttributeDisplay(attributeBox[i], i);
          i = i + 1;
        {% endfor %}

        if(note != undefined && note.length > 1){
          addCartNoteDisplay();
        }
        $('.step__sections').append('<div class="content-box"><div class="content-box__row content-box__row--no-border"><h2>マイページ・会員登録</h2></div><!-- content-box --><div class="content-box__row"><div class="section__content"><p style="display:block; margin-bottom: 5px;">▼注文内容・履歴の確認はこちらから</p><a href="/account" style="display: block; margin-bottom: 15px;">マイページ(アカウントをお持ちの方)</a><span class="register_ttl" style="display:block; margin-bottom: 5px;">▼アカウントをお持ちでない方は</span><a href="/account/register" style="display: block;">アカウントの作成</a></div><!-- section__content --></div><!-- content-box__row --></div><!-- content-box -->');

        $('.step__sections').append(
          '<div class="line_wrapper"><h2 class="line_ttl">Komons公式LINE</h2><div class="img_wrap"><a target="_blank" href="https://page.line.me/266mlpqk"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/line_banner_313769a8-6429-4ae0-9071-efb7430133ef.jpg?v=1721105968"></a></div><h3 class="line_sub_ttl">注文や配送の状況をLINEでお知らせ！</h3><div class="line_description"><p>新商品・限定商品やお得なクーポンやキャンペーン情報なども週1回程度のペースでお知らせしております。</p></div><div class="line_button"><a target="_blank" href="https://page.line.me/266mlpqk"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/line_button_3cc6d565-d4cf-4138-9eb0-d3034cb8dfee.png?v=1721106174"></a></div></div>'
        );

        $('.step__sections').append('<div class="instagram"><div class="title_wrap"><div class="ttl_box"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/insta_ttl.png?v=1636372383"></div><div class="link_wrap"><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/insta_link.png?v=1636372383"></a></div></div><div class="insta_wrap"><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta01.jpg?v=1721105091"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta02.jpg?v=1721105091"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta03.jpg?v=1721105092" ></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta04.jpg?v=1721105093"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta05.jpg?v=1721105093"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta06.jpg?v=1721105093"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta07.jpg?v=1721105091"></a><a target="_blank" href="https://www.instagram.com/komons.jp/"><img src="https://cdn.shopify.com/s/files/1/0536/9544/7234/files/co_insta08.jpg?v=1721105091"></a></div></div>');

        if(paymentMethod == '代金引換'){
          addCODPrice();
        }
      }

      init();

    }

    checkoutSet();

  });
</script>

{% comment %}CRM PLUS on LINE ここから{% endcomment %}
<script>
  const socialplusLineConnectionConfig = {
    title: 'LINEのID連携で、お得で便利に！',
    features: [
      {
        text: 'LINE限定のお得な情報をお届け',
        image: 'https://shop.socialplus.jp/storefront/line-connection-icons/special-information.svg',
      },
      {
        text: 'おすすめの商品情報をお届け',
        image: 'https://shop.socialplus.jp/storefront/line-connection-icons/product-information.svg',
      },
      {
        text: 'お荷物の発送をお知らせ',
        image: 'https://shop.socialplus.jp/storefront/line-connection-icons/shipping-notification.svg',
      },
    ],
  };
</script>

{% assign primary_locale = shop.published_locales | where: 'primary' | first %}
{% assign customer_email_hash_issued_at = 'now' | date: '%s' %}

<script
  defer
  src="https://shop.socialplus.jp/storefront/bundle.js"
  class="socialplus-line-connection-from-order-status"
  data-primary-locale="{{ primary_locale.iso_code }}"
  data-customer-email="{{ customer.email }}"
  data-customer-email-hash="{{ customer.email | append: customer_email_hash_issued_at | hmac_sha256: '2e47bb13ceaaa2ecdf69dfb0123fcce214ab08f670ed89548365395d5ea60f79' }}"
  data-customer-email-hash-issued-at="{{ customer_email_hash_issued_at }}"
  data-order-customer-url="{{ order.customer_url }}"
></script>
{% comment %}CRM PLUS on LINE ここまで{% endcomment %}

{% if first_time_accessed %}
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5LVFKHJ');</script>
<script>
window.dataLayer = window.dataLayer || [];
  dataLayer.push({ ecommerce: null });  // Clear the previous ecommerce object.
  dataLayer.push({
    event: "cv_conversion",
    ecommerce: {
        transaction_id: "{{ order_number }}",  // 取引を一意に識別するID
        value: "{{ checkout.subtotal_price | money_without_currency | remove: ',' }}", // 売上の総額
        currency: "JPY", // 通貨コード
        items: [
        {% for line_item in checkout.line_items %}
        {
          item_name: "{{ line_item.title }}", // 商品名
          item_id: "{{ line_item.product_id }}", // 商品コード
          price: "{{ line_item.final_price | money_without_currency | remove: ',' }}", // 商品価格
          quantity: "{{ line_item.quantity }}", // 数量
        },
        {% endfor %}
        ]
    }
  });
  console.log('GTM');
</script>

{% endif %}
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5LVFKHJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
